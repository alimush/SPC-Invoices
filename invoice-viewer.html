<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>عرض الفاتورة</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body class="p-6 bg-gray-100">

  <div class="max-w-4xl mx-auto bg-white p-6 rounded shadow" id="invoiceContainer">
    <!-- سيتم جلب الفاتورة من الصفحة الرئيسية -->
  </div>

  <div class="flex justify-center gap-4 mt-4">
    <button onclick="adjustMargin(-5)" class="bg-gray-700 text-white px-3 py-1 rounded">⬆️</button>
    <button onclick="adjustMargin(5)" class="bg-gray-700 text-white px-3 py-1 rounded">⬇️</button>
    <button onclick="generatePDF()" class="bg-green-700 text-white px-3 py-1 rounded">توليد PDF</button>
    <button onclick="goBack()" class="bg-red-700 text-white px-3 py-1 rounded">رجوع للصفحة الرئيسية</button>
  </div>

  <script>
    let footerMargin = 21;
    let invoiceHTML = '';

    function loadInvoice() {
      if (window.opener) {
        invoiceHTML = window.opener.document.getElementById('invoice').innerHTML;
        document.getElementById('invoiceContainer').innerHTML = invoiceHTML.replace(/mt-\[\d+rem\]/g, `mt-[${footerMargin}rem]`);
      }
    }

    function adjustMargin(change) {
      footerMargin = Math.max(0, footerMargin + change);
      updateInvoiceMargin();
    }

    function updateInvoiceMargin() {
      // نعدل المارجن فقط
      document.getElementById('invoiceContainer').innerHTML = invoiceHTML.replace(/mt-\[\d+rem\]/g, `mt-[${footerMargin}rem]`);
    }

    function generatePDF() {
      const element = document.getElementById('invoiceContainer');
      html2pdf().set({
        margin: 10,
        filename: 'quotation.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 3, scrollY: 0, useCORS: true },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
      }).from(element).save();
    }

    function goBack() {
      if (window.opener) {
        window.opener.focus();
      }
      window.close();
    }

    window.onload = loadInvoice;
  </script>

</body>
</html>
